
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">

<!--
	Copyright (c) 1999-2012 by Digital Mars
	All Rights Reserved Written by Walter Bright
	http://digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>Vector Extensions - D Programming Language</title>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />

<script src="/js/hyphenate_selectively.js" type="text/javascript"></script>

<script type="text/javascript">
function bodyLoad()
{
	var links = document.getElementById("navigation").getElementsByTagName("a");
	for (var i = 0; i < links.length; i++)
	{
		var url = "/" + links[i].getAttribute("href");
		if (window.location.href.match(url + "\x24") == url)
		{
			var cls = links[i].getAttribute("class");
			links[i].setAttribute("class", cls ? cls + " active" : "active");
			break;
		}
	}
}
</script>

<script type="text/javascript">
/*
(C) www.dhtmlgoodies.com, September 2005

This is a script from www.dhtmlgoodies.com. You will find this and a lot of other scripts at our website.

Terms of use:
You are free to use this script as long as the copyright message is kept intact. However, you may not
redistribute, sell or repost it without our permission.

Thank you!

www.dhtmlgoodies.com
Alf Magne Kalleland

*/
function showHideAnswer(zis)
{
	var numericID = zis.id.replace(/[^\d]/g,'');
	var obj = document.getElementById('a' + numericID);
	if(obj.style.display=='block'){
        zis.innerHTML = '<span class="nobr">See example.</span>';
		obj.style.display='none';
	}else{
        zis.innerHTML = '<span class="nobr">Hide example.</span>';
		obj.style.display='block';
	}
}
</script>

</head>

<body onLoad='bodyLoad()'>

<div id="top">
	<div id="search-box">
		<form method="get" action="http://google.com/search">
			<img src="/images/search-left.gif" width="11" height="22" /><input id="q" name="q" /><input type="image" id="search-submit" name="submit" src="/images/search-button.gif" />
			<input type="hidden" id="domains" name="domains" value="d-programming-language.org" />
			<input type="hidden" id="sourceid" name="sourceid" value="google-search" />
			<div id="search-dropdown">
				<select id="sitesearch" name="sitesearch" size="1">
					<option value="d-programming-language.org">Entire D Site</option>
					<option value="d-programming-language.org/phobos">Library Reference</option>
					<option value="digitalmars.com/d/archives">Newsgroup Archives</option>
				</select>
			</div>
		</form>
	</div>
	<div id="header">
		<a id="d-language" href="/">
		<img id="logo" width="125" height="95" border="0" alt="D Logo" src="images/dlogo.png">
		D Programming Language</a>
	</div>
</div>

<!-- Generated by Ddoc from simd.dd -->



<div id="navigation">
  

<div class="navblock">
<h2><a href="index.html" title="D Programming Language">D Home</a></h2>
<ul>	<li><a href="overview.html" title="D language overview">Overview</a></li>

	<li><a href="comparison.html" title="D feature list">Features</a></li>

	<li><a href="download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>

	<li><a href="changelog.html" title="History of changes to D">Changelog</a></li>
	<li><a href="bugstats.php" title="D issue and bug tracking system">Bug tracker</a></li>
	<li><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>

	<li><a href="appendices.html">Appendices</a></li>
	<li><a href="acknowledgements.html" title="Thank-you to these people who have helped with D">Acknowledgments</a></li>
	<li><a href="sitemap.html" title="Documents on this site, indexed alphabetically">Sitemap</a></li>
	<li><a href="http://digitalmars.com/d/1.0/index.html" title="D Programming Language 1.0">D1 Home</a></li>
</ul>
    </div>


<div class="navblock">
<h2>Documentation</h2>
<ul>    <li><a href="http://www.amazon.com/exec/obidos/ASIN/0321635361/classicempire">Book</a>
</li>
	<li><a href="http://www.informit.com/articles/article.aspx?p=1381876">&nbsp;<font size=-1><span style="visibility: hidden">3</span>1.&nbsp;Tutorial</font></a></li>
	<li><a href="http://www.informit.com/articles/article.aspx?p=1609144">&nbsp;<font size=-1>13.&nbsp;Concurrency</font></a></li>

	<li><a href="language-reference.html">Language Reference</a>

    <div class="navblock">
<ul>	<li><a href="lex.html">Lexical</a></li>
	<li><a href="module.html">Modules</a></li>
	<li><a href="declaration.html">Declarations</a></li>
	<li><a href="type.html">Types</a></li>
	<li><a href="property.html">Properties</a></li>
	<li><a href="attribute.html">Attributes</a></li>
	<li><a href="pragma.html">Pragmas</a></li>
	<li><a href="expression.html">Expressions</a></li>
	<li><a href="statement.html">Statements</a></li>
	<li><a href="arrays.html">Arrays</a></li>
	<li><a href="hash-map.html">Associative Arrays</a></li>
	<li><a href="struct.html">Structs &amp; Unions</a></li>
	<li><a href="class.html">Classes</a></li>
	<li><a href="interface.html">Interfaces</a></li>
	<li><a href="enum.html">Enums</a></li>
	<li><a href="const3.html">Const and Immutable</a></li>
	<li><a href="function.html">Functions</a></li>
	<li><a href="operatoroverloading.html">Operator Overloading</a></li>
	<li><a href="template.html">Templates</a></li>
	<li><a href="template-mixin.html">Template Mixins</a></li>
	<li><a href="dbc.html">Contracts</a></li>
	<li><a href="version.html">Conditional Compilation</a></li>
	<li><a href="simd.html">Vector Extensions</a></li>
	<li><a href="traits.html">Traits</a></li>
	<li><a href="errors.html">Handling errors</a></li>
	<li><a href="unittest.html">Unit Tests</a></li>
	<li><a href="garbage.html">Garbage Collection</a></li>
	<li><a href="float.html">Floating Point</a></li>
	<li><a href="iasm.html">Inline Assembler</a></li>
	<li><a href="ddoc.html">Documentation Comments</a></li>
	<li><a href="interfaceToC.html">Interfacing To C</a></li>
	<li><a href="cpp_interface.html">Interfacing To C++</a></li>
	<li><a href="portability.html">Portability Guide</a></li>
	<li><a href="entity.html">Named Character Entities</a></li>
	<li><a href="memory-safe-d.html">Memory Safe D Spec</a></li>
	<li><a href="abi.html">Application Binary Interface</a></li>
    </ul>
</div>
</li>
	<li><a href="phobos/index.html">Library Reference</a></li>
	<li><a href="howtos.html" title="Helps for using D">Howtos</a></li>

	<li><a href="articles.html">Articles</a></li>
</ul>
    </div>


<div class="navblock">
<h2>Community</h2>
<ul>	<li><a href="http://digitalmars.com/NewsGroup.html" title="User forums">Forums</a></li>
	<li><a href="http://github.com/D-Programming-Language" title="D on github">Github</a></li>
	<li><a href="http://prowiki.org/wiki4d/wiki.cgi?FrontPage" title="Wiki for the D Programming Language">Wiki</a></li>
	<li><a href="http://prowiki.org/wiki4d/wiki.cgi?ReviewQueue" title="Queue of current and upcoming standard library additions">Review queue</a></li>
	<li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>
	<li><a href="http://digitalmars.com/d/dlinks.html" title="External D related links">Links</a></li>
	
</ul>
    </div>


  
<div id="translate" class="tool">Translate this page:
	<div id="google_translate_element"></div><script type="text/javascript">
	function googleTranslateElementInit() {
	  new google.translate.TranslateElement({
	    pageLanguage: 'en',
	    autoDisplay: false,
	    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
	  }, 'google_translate_element');
	}
	</script>
<script type="text/javascript" src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</div>

</div><!--/navigation-->
<div id="content" class='hyphenate'>
  
<div id="tools">
	<!--span id="lastupdate">Last update Mon Mar  5 00:18:22 2012
</span-->
	<span id="wiki"><a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Float">Comment on this page</a></span>
</div>

  <h1>Vector Extensions</h1>
  
	<p>Modern CPUs often support specialized vector types and vector
	operations, sometimes called "media instructions".
	Vector types are a fixed array of floating or integer types, and
	vector operations operate simultaneously on them, thus achieving
	great speedups.</p>

	<p>When the compiler takes advantage of these instructions with standard D code
	to speed up loops over arithmetic data, this is called auto-vectorization.
	Auto-vectorization, however, has had only limited success and has not
	been able to really take advantage of the richness (and often quirkiness)
	of the native vector instructions.
	</p>

	<p>D has the array operation notation, such as:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span>[] a,b;
...
a[] += b[];
</span></pre>

	<p>which can be vectorized by the compiler, but again success is limited
	for the same reason auto-vectorization is.
	</p>

	<p>The difficulties with trying to use vector instructions on regular arrays
	are:</p>

	<ol>	<li>The vector types have stringent alignment requirements that are not
	and cannot be met by conventional arrays.</li>
	<li>C ABI's often have vector extensions and have special name mangling
	for them, call/return conventions, and symbolic debug support.</li>
	<li>The only way to get at the full vector instruction set would be to use
	inline assembler - but the compiler cannot do register allocation across
	inline assembler blocks (or other optimizations), leading to poor code
	performance.</li>
	<li>Interleaving conventional array code with vector operations on the same
	data can unwittingly lead to extremely poor runtime performance.</li>
	</ol>

	<p>These issues are cleared up by using special vector types.
	</p>

<h2><span class="notranslate"><span class="d_inlinecode">core.simd</span></span></h2>

	<p>Vector types and operations are introduced to D code by importing
	<a href="phobos/core_simd.html"><span class="notranslate"><span class="d_inlinecode">core.simd</span></span></a>:</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">import</span> core.simd;
</span></pre>

	<p>These types and operations will be the ones defined for the architecture
	the compiler is targetting. If a particular CPU family has varying
	support for vector types, an additional runtime check may be necessary.
	The compiler does not emit runtime checks; those must be done by the programmer.
	</p>

	<p>The types defined will all follow the naming convention:</p>

<pre class="bnf"><span class="notranslate"><i>typeNN</i>
</span></pre>
	<p>where <i>type</i> is the vector element type and <i>NN</i> is the number
	of those elements in the vector type.
	The type names will not be keywords.
	</p>

<h3>Properties</h3>

	<p>Vector types have the property:</p>

	<center><table border=1 cellpadding=4 cellspacing=0><caption>Vector Type Properties</caption>
	<tr><th>Property</th><th>Description</th></tr>
	<tr><td>.array</td><td>Returns static array representation</td></tr>
	</table></center>

	<p>All the properties of the static array representation also work.</p>

<h3>Conversions</h3>

	<p>Vector types of the same size can be implicitly converted among
	each other. Vector types can be cast to the static array representation.</p>

	<p>Integers and floating point values can be implicitly converted
	to their vector equivalents:</p>

<pre class="d_code"><span class="notranslate">int4 v = 7;
v = 3 * v;   <span class="d_comment">// multiply each element in v by 3
</span></span></pre>

<h3>Accessing Individual Vector Elements</h3>

	<p>They cannot be accessed directly, but can be when converted to
	an array type:</p>

<pre class="d_code"><span class="notranslate">int4 v;
(<span class="d_keyword">cast</span>(<span class="d_keyword">int</span>*)&amp;v)[3] = 2;   <span class="d_comment">// set 3rd element of the 4 int vector
</span><span class="d_keyword">cast</span>(<span class="d_keyword">int</span>[4])v[3] = 2;    <span class="d_comment">// set 3rd element of the 4 int vector
</span>v.array[3] = 2;          <span class="d_comment">// set 3rd element of the 4 int vector
</span>v.ptr[3] = 2;            <span class="d_comment">// set 3rd element of the 4 int vector
</span></span></pre>


<h3>Conditional Compilation</h3>

	<p>If vector extensions are implemented, the
	<a href="version.html#PredefinedVersions">version identifier</a>
	<span class="notranslate"><span class="d_inlinecode">D_SIMD</span></span> is set.</p>

	<p>Whether a type exists or not can be tested at compile time with
	an <a href="expression.html#IsExpression"><i>IsExpression</i></a>:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">static</span> <span class="d_keyword">if</span> (<span class="d_keyword">is</span>(<i>typeNN</i>))
    ... yes, it <span class="d_keyword">is</span> supported ...
<span class="d_keyword">else</span>
    ... nope, use workaround ...
</span></pre>

	<p>Whether a particular operation on a type is supported can be tested
	at compile time with:
	</p>

<pre class="d_code"><span class="notranslate">float4 a,b;
<span class="d_keyword">static</span> <span class="d_keyword">if</span> (<span class="d_keyword">__traits</span>(compiles, a+b))
    ... yes, it <span class="d_keyword">is</span> supported ...
<span class="d_keyword">else</span>
    ... nope, use workaround ...
</span></pre>

	<p>For runtime testing to see if certain vector instructions are
	available, see the functions in <a href="phobos/core_cpuid.html">core.cpuid</a>.
	</p>

	<p>A typical workaround would be to use array vector operations instead:</p>

<pre class="d_code"><span class="notranslate">float4 a,b;
<span class="d_keyword">static</span> <span class="d_keyword">if</span> (<span class="d_keyword">__traits</span>(compiles, a/b))
    c = a / b;
<span class="d_keyword">else</span>
    c[] = a[] / b[];
</span></pre>

<h2>X86 And X86_64 Vector Extension Implementation</h2>

	<p>The rest of this document describes the specific implementation of the
	vector types for the X86 and X86_64 architectures.
	</p>

	<p>The vector extensions are currently implemented for the OS X 32
	bit target, and all 64 bit targets.</p>

	<p><a href="phobos/core_simd.html"><span class="notranslate"><span class="d_inlinecode">core.simd</span></span></a> defines the following types: </p>

	<center><table border=1 cellpadding=4 cellspacing=0><caption>Vector Types</caption>
	<tr><th>Type Name</th><th>Description</th><th>gcc Equivalent</th></tr>
	<tr><td>void16</td><td>16 bytes of untyped data</td><td><i>no equivalent</i></td></tr>
	<tr><td>byte16</td><td>16 <span class="notranslate"><span class="d_inlinecode">byte</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">signed char __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>ubyte16</td><td>16 <span class="notranslate"><span class="d_inlinecode">ubyte</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">unsigned char __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>short8</td><td>8 <span class="notranslate"><span class="d_inlinecode">short</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">short __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>ushort8</td><td>8 <span class="notranslate"><span class="d_inlinecode">ushort</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">ushort __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>int4</td><td>4 <span class="notranslate"><span class="d_inlinecode">int</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">int __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>uint4</td><td>4 <span class="notranslate"><span class="d_inlinecode">uint</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">unsigned __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>long2</td><td>2 <span class="notranslate"><span class="d_inlinecode">long</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">long __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>ulong2</td><td>2 <span class="notranslate"><span class="d_inlinecode">ulong</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">unsigned long __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>float4</td><td>4 <span class="notranslate"><span class="d_inlinecode">float</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">float __attribute((vector_size(16)))</span></span></td></tr>
	<tr><td>double2</td><td>2 <span class="notranslate"><span class="d_inlinecode">double</span></span>'s</td><td><span class="notranslate"><span class="d_inlinecode">double __attribute((vector_size(16)))</span></span></td></tr>
	</table></center>

	<p>Note: for 32 bit gcc, it's <span class="notranslate"><span class="d_inlinecode">long long</span></span> instead of <span class="notranslate"><span class="d_inlinecode">long</span></span>.</p>

	<center><table border=1 cellpadding=4 cellspacing=0><caption>Supported Vector Operators</caption>
	<tr><th>Operator</th><th>void16</th><th>byte16</th><th>ubyte16</th><th>short8</th><th>ushort8</th><th>int4</th><th>uint4</th><th>long2</th><th>ulong2</th><th>float4</th><th>double2</th></tr>
	<tr><td>=</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td>+ +=</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td>- -=</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td>* *=</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td>/ /=</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td>&amp; &amp;=</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&ndash;</td><td>&ndash;</td></tr>
	<tr><td>| |=</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&ndash;</td><td>&ndash;</td></tr>
	<tr><td>^ ^=</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&ndash;</td><td>&ndash;</td></tr>
	<tr><td><i>unary</i>~</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&ndash;</td><td>&ndash;</td></tr>
	<tr><td><i>unary</i>+</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td></tr>
	<tr><td><i>unary</i>-</td><td>&ndash;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td><td>&times;</td></tr>
	</table></center>

	<p>Operators not listed are not supported at all.</p>

<h3>Vector Operation Intrinsics</h3>

	<p>See <a href="phobos/core_simd.html"><span class="notranslate"><span class="d_inlinecode">core.simd</span></span></a> for the supported intrinsics.</p>

  
<div id="google_ad">
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

</div><!--/content-->





<div id="footernav">
<a href="http://digitalmars.com/NewsGroup.html" title="User Forums">Forums</a> |
<a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Float" title="Read/write comments and feedback">Comments</a> |
<a href="http://digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a> |
<a href="download.html" title="Download D">Downloads</a> |
<a href="/">Home</a>
</div>
<div id="copyright">

Copyright &copy; 1999-2012 by Digital Mars &reg;, All Rights Reserved
 |
Page generated by <a href="ddoc.html">Ddoc</a> on Mon Mar  5 00:18:22 2012

</div>

</body>
</html>

